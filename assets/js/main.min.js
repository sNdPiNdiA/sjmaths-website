const appThemes={purple:{primary:"#8e44ad","primary-dark":"#6c3483","primary-light":"#a569bd",secondary:"#e74c3c",accent:"#f39c12"},blue:{primary:"#2563eb","primary-dark":"#1e40af","primary-light":"#60a5fa",secondary:"#0ea5e9",accent:"#22c55e"},green:{primary:"#16a34a","primary-dark":"#166534","primary-light":"#4ade80",secondary:"#22c55e",accent:"#facc15"},orange:{primary:"#f97316","primary-dark":"#c2410c","primary-light":"#fdba74",secondary:"#ef4444",accent:"#f59e0b"}};function applyThemeVars(e){const t=appThemes[e];if(!t)return;const o=document.documentElement.style;Object.entries(t).forEach(([r,i])=>{o.setProperty(`--${r}`,i)})}window.setTheme=function(e){applyThemeVars(e),localStorage.setItem("sjmaths-theme",e)};const initDarkMode=()=>{if(localStorage.getItem("sjmaths-dark")==="on"){document.body.classList.add("dark-mode");const n=document.querySelector("#darkToggle i")||document.querySelector("#theme-toggle i");n&&(n.classList.remove("fa-moon"),n.classList.add("fa-sun"))}const t=n=>{const s=n.querySelector("i");if(!s)return;const c=document.body.classList.contains("dark-mode");s.className=c?"fas fa-sun":"fas fa-moon",n.classList.contains("floating-dark-btn")&&(n.style.background=c?"#ffffff":"#2c3e50",n.style.color=c?"#2c3e50":"#ffffff")};document.addEventListener("click",n=>{const s=n.target.closest("#darkToggle, #theme-toggle");if(!s)return;const c=document.body.classList.toggle("dark-mode");localStorage.setItem("sjmaths-dark",c?"on":"off"),t(s)});const o=()=>{let n=document.getElementById("darkToggle");n&&!n.classList.contains("floating-dark-btn")&&(n.remove(),n=null),n||(n=document.createElement("button"),n.id="darkToggle",n.className="floating-dark-btn",n.innerHTML='<i class="fas fa-moon"></i>',n.setAttribute("aria-label","Toggle Dark Mode"),Object.assign(n.style,{position:"fixed",bottom:"20px",left:"20px",width:"50px",height:"50px",borderRadius:"50%",border:"none",boxShadow:"0 4px 15px rgba(0,0,0,0.3)",zIndex:"9999",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"1.2rem",transition:"all 0.3s ease"}),document.body.appendChild(n)),t(n)};o();const r=new MutationObserver(()=>{const n=document.querySelectorAll("#darkToggle");n.length>1?n.forEach(s=>{s.classList.contains("floating-dark-btn")||s.remove()}):n.length===0&&o()}),i=document.getElementById("header-container")||document.querySelector("header");i&&r.observe(i,{childList:!0,subtree:!0})},initScrollAnimations=()=>{if(!("IntersectionObserver"in window)){document.querySelectorAll(".animate-on-scroll").forEach(r=>r.classList.add("is-visible"));return}const e={threshold:.1,rootMargin:"0px 0px -20px 0px"},t=new IntersectionObserver(r=>{r.forEach(i=>{i.isIntersecting&&(i.target.classList.add("is-visible"),t.unobserve(i.target))})},e);document.querySelectorAll(".animate-on-scroll").forEach(r=>t.observe(r)),setTimeout(()=>{document.querySelectorAll(".animate-on-scroll:not(.is-visible)").forEach(i=>i.classList.add("is-visible"))},1e3)},initParallax=()=>{if(window.innerWidth<768||window.matchMedia("(prefers-reduced-motion: reduce)").matches)return;const e=document.querySelectorAll(".blob");if(!e.length)return;let t=!1;window.addEventListener("scroll",()=>{t||(window.requestAnimationFrame(()=>{const o=window.scrollY;e.forEach((r,i)=>{const n=(i+1)*.15;r.style.transform=`translateY(${o*n}px)`}),t=!1}),t=!0)})},initHeroSlider=()=>{const e=document.getElementById("heroCarousel"),t=document.querySelectorAll(".indicator"),o=document.querySelectorAll(".carousel-slide"),r=document.getElementById("heroPrev"),i=document.getElementById("heroNext");if(!e||!o.length)return;let n=0,s;const c=a=>{o.forEach(l=>l.classList.remove("active")),o[a].classList.add("active"),g(a),n=a},g=a=>{t.forEach((l,v)=>{l.classList.toggle("active",v===a)})},u=()=>{d(),s=setInterval(()=>{const a=(n+1)%o.length;c(a)},4e3)},d=()=>clearInterval(s);let f=0,p=0;const h=()=>{if(f-p>50){const a=(n+1)%o.length;c(a)}if(p-f>50){const a=(n-1+o.length)%o.length;c(a)}},m=document.querySelector(".hero");m&&(m.addEventListener("mouseenter",d),m.addEventListener("mouseleave",u),m.addEventListener("touchstart",a=>{d(),f=a.changedTouches[0].screenX},{passive:!0}),m.addEventListener("touchend",a=>{p=a.changedTouches[0].screenX,h(),u()})),e.addEventListener("click",a=>{const l=a.target.closest(".hero-content");if(l&&l.dataset.href){if(a.target.closest("a")||a.target.closest("button"))return;window.location.href=l.dataset.href}}),t.forEach((a,l)=>{a.addEventListener("click",()=>{d(),c(l)})}),r&&r.addEventListener("click",()=>{d();const a=(n-1+o.length)%o.length;c(a)}),i&&i.addEventListener("click",()=>{d();const a=(n+1)%o.length;c(a)}),u()};let deferredPrompt;const installBtnId="pwa-install-btn";window.addEventListener("beforeinstallprompt",e=>{console.log("PWA: beforeinstallprompt event fired"),e.preventDefault(),deferredPrompt=e,showInstallButton()});function showInstallButton(){let e=document.getElementById(installBtnId);e||(e=document.createElement("button"),e.id=installBtnId,e.className="install-app-btn",e.innerHTML='<i class="fas fa-download"></i> <span class="btn-text">Install App</span>',document.body.appendChild(e),e.onclick=async()=>{if(!deferredPrompt)return;deferredPrompt.prompt();const{outcome:t}=await deferredPrompt.userChoice;deferredPrompt=null,e.remove()})}window.addEventListener("appinstalled",()=>{const e=document.getElementById(installBtnId);e&&e.remove(),deferredPrompt=null});const initBackToTop=()=>{const e=document.getElementById("backToTop");if(!e)return;let t=!1;window.addEventListener("scroll",()=>{t||(window.requestAnimationFrame(()=>{window.scrollY>300?e.classList.add("show"):e.classList.remove("show"),t=!1}),t=!0)}),e.addEventListener("click",()=>{window.scrollTo({top:0,behavior:"smooth"})})},initSmoothScroll=()=>{document.addEventListener("click",e=>{const t=e.target.closest('a[href^="#"]');if(!t)return;const o=t.getAttribute("href");if(!(!o||o==="#"||!o.startsWith("#")))try{const r=document.querySelector(o);if(r){e.preventDefault();const s=r.getBoundingClientRect().top+window.scrollY-90;window.scrollTo({top:s,behavior:"smooth"})}}catch{}})},initGlobalSmoothScroll=()=>{document.documentElement.style.scrollBehavior="smooth"},initCelebration=()=>{if((window.location.pathname==="/"||window.location.pathname.endsWith("/index.html"))&&typeof confetti=="function"){if(sessionStorage.getItem("sjmaths_launch_celebrated"))return;sessionStorage.setItem("sjmaths_launch_celebrated","true"),window.showToast&&setTimeout(()=>window.showToast("Welcome to SJMaths! \u{1F680}","success"),500);const o=Date.now()+3e3,r=["#8e44ad","#9b59b6","#f39c12","#e74c3c","#ffffff"];(function i(){confetti({particleCount:3,angle:60,spread:55,origin:{x:0},colors:r,zIndex:10001}),confetti({particleCount:3,angle:120,spread:55,origin:{x:1},colors:r,zIndex:10001}),Date.now()<o&&requestAnimationFrame(i)})()}},initServiceWorker=()=>{"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/service-worker.js").then(t=>{if(t.update(),t.waiting){showUpdateNotification(t.waiting);return}t.addEventListener("updatefound",()=>{const o=t.installing;o.addEventListener("statechange",()=>{o.state==="installed"&&navigator.serviceWorker.controller&&showUpdateNotification(o)})})}).catch(t=>console.error("Service Worker registration failed",t));let e;navigator.serviceWorker.addEventListener("controllerchange",()=>{e||(window.location.reload(),e=!0)})})};function showUpdateNotification(e){if(document.querySelector(".update-toast"))return;const t=document.createElement("div");if(t.className="update-toast",t.innerHTML=`
        <div style="display:flex; align-items:center; gap:12px;">
            <div style="background:var(--accent-purple-light, #f3e5f5); color:var(--primary); width:40px; height:40px; border-radius:50%; display:flex; align-items:center; justify-content:center; flex-shrink:0;">
                <i class="fas fa-sync-alt fa-spin"></i>
            </div>
            <div style="flex:1;">
                <div style="font-weight:600; font-size:0.9rem; color:var(--text-dark);">Update Available</div>
                <div style="font-size:0.8rem; color:var(--text-body);">New content is ready.</div>
            </div>
            <button id="reloadBtn" style="background:var(--primary); color:white; border:none; padding:8px 16px; border-radius:20px; cursor:pointer; font-weight:600; font-size:0.8rem; box-shadow: 0 2px 5px rgba(0,0,0,0.2); white-space:nowrap;">Update</button>
            <button id="dismissBtn" style="background:transparent; color:var(--text-light); border:none; cursor:pointer; font-size:1.2rem; padding:0 5px;">&times;</button>
        </div>
    `,Object.assign(t.style,{position:"fixed",bottom:"20px",right:"20px",background:"var(--bg-card, #fff)",padding:"12px 16px",borderRadius:"16px",boxShadow:"0 10px 40px rgba(0,0,0,0.15)",zIndex:"10000",fontFamily:"'Poppins', sans-serif",minWidth:"320px",border:"1px solid var(--border-color, #eee)",animation:"slideUp 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275)"}),!document.getElementById("toast-anim")){const o=document.createElement("style");o.id="toast-anim",o.innerHTML="@keyframes slideUp { from { transform: translateY(100px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }",document.head.appendChild(o)}document.body.appendChild(t);try{const o=window.AudioContext||window.webkitAudioContext;if(o){const r=new o,i=r.createOscillator(),n=r.createGain();i.connect(n),n.connect(r.destination),i.type="sine",i.frequency.setValueAtTime(523.25,r.currentTime),i.frequency.exponentialRampToValueAtTime(1046.5,r.currentTime+.1),n.gain.setValueAtTime(.1,r.currentTime),n.gain.exponentialRampToValueAtTime(.001,r.currentTime+.5),i.start(),i.stop(r.currentTime+.5)}}catch{}"vibrate"in navigator&&navigator.vibrate([200,100,200]),t.querySelector("#reloadBtn").addEventListener("click",()=>e.postMessage({type:"SKIP_WAITING"})),t.querySelector("#dismissBtn").addEventListener("click",()=>{t.style.opacity="0",t.style.transform="translateY(20px)",t.style.transition="all 0.3s ease",setTimeout(()=>t.remove(),300)})}const initNetworkStatus=()=>{const e=(t,o)=>{const r=document.createElement("div");r.className="network-toast",r.textContent=t,Object.assign(r.style,{position:"fixed",bottom:"90px",left:"50%",transform:"translateX(-50%)",background:o==="online"?"var(--secondary, #22c55e)":"#e74c3c",color:"white",padding:"8px 20px",borderRadius:"50px",zIndex:"10000",boxShadow:"0 4px 15px rgba(0,0,0,0.2)",transition:"opacity 0.5s",opacity:"0",fontSize:"0.9rem",fontWeight:"500"}),document.body.appendChild(r),requestAnimationFrame(()=>r.style.opacity="1"),setTimeout(()=>{r.style.opacity="0",setTimeout(()=>r.remove(),500)},3e3)};window.addEventListener("online",()=>e("You are back online!","online")),window.addEventListener("offline",()=>e("You are offline. Some features may be unavailable.","offline"))};document.addEventListener("DOMContentLoaded",()=>{initDarkMode(),initScrollAnimations(),initParallax(),initHeroSlider(),initBackToTop(),initSmoothScroll(),initGlobalSmoothScroll(),initCelebration(),initNetworkStatus()}),initServiceWorker();
