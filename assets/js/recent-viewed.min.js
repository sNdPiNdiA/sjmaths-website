const CONTENT_PATTERNS=["/chapter-wise-notes/","/ncert-exercise-practice/","/previous-year-questions/","/sample-papers/set","/worksheets/","/maths-mastery/"],MAX_HISTORY_ITEMS=4,STORAGE_KEY="sjmaths_recent_history";document.addEventListener("DOMContentLoaded",()=>{trackPageView(),renderRecentViewed()});function trackPageView(){const e=window.location.pathname;if(!CONTENT_PATTERNS.some(o=>e.includes(o))||document.querySelector(".dashboard-grid"))return;let t=document.title.split("|")[0].split("-")[0].replace("SJMaths","").trim();const a=window.location.href;let n="Resource",s="fa-file-alt";e.includes("notes")?(n="Notes",s="fa-book-open"):e.includes("ncert")?(n="Solution",s="fa-pen-nib"):e.includes("pyq")||e.includes("questions")?(n="PYQ",s="fa-history"):e.includes("sample")?(n="Sample Paper",s="fa-file-contract"):e.includes("mastery")&&(n="Concept",s="fa-brain");const r={title:t||"Untitled Resource",url:a,type:n,icon:s,timestamp:Date.now()};let i=JSON.parse(localStorage.getItem(STORAGE_KEY)||"[]");i=i.filter(o=>o.url!==a),i.unshift(r),i.length>4&&i.pop(),localStorage.setItem(STORAGE_KEY,JSON.stringify(i))}function renderRecentViewed(){const e=document.getElementById("recent-viewed-container");if(!e)return;const c=JSON.parse(localStorage.getItem(STORAGE_KEY)||"[]");if(c.length===0){e.style.display="none";return}e.innerHTML=`
        <div class="recent-section">
            <div class="section-header-recent">
                <h2><i class="fas fa-history"></i> Pick up where you left off</h2>
                <button onclick="clearRecentHistory()" class="clear-btn">Clear</button>
            </div>
            <div class="recent-grid">
                ${c.map(t=>`
                    <a href="${t.url}" class="recent-card">
                        <div class="recent-icon"><i class="fas ${t.icon}"></i></div>
                        <div class="recent-info">
                            <span class="recent-type">${t.type}</span>
                            <h4 class="recent-title">${t.title}</h4>
                        </div>
                    </a>
                `).join("")}
            </div>
        </div>
    `,e.style.display="block"}window.clearRecentHistory=function(){localStorage.removeItem(STORAGE_KEY);const e=document.getElementById("recent-viewed-container");e&&(e.style.display="none")};
