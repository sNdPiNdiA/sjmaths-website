<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sign Up - SJMaths</title>

    <!-- SEO Meta Tags -->
    <meta name="description" content="Create your SJMaths account to access exclusive mathematics resources, notes, and practice questions for Class 9 to 12. Join our community of students mastering maths.">
    <meta name="keywords" content="Sign up SJMaths, create account, maths resources registration, student login, CBSE maths preparation">
    <meta name="robots" content="index, follow">
    <meta name="author" content="SJMaths">

    <!-- Open Graph -->
    <meta property="og:title" content="Sign Up - SJMaths">
    <meta property="og:description" content="Join SJMaths to master mathematics with comprehensive notes, PYQs, and expert guidance.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://www.sjmaths.com/signup.html">

    <link rel="icon" type="image/svg+xml" href="assets/favicon.svg">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="assets/css/hero.css">
    <link rel="stylesheet" href="assets/css/auth.css">
</head>

<body>

    <div class="blob blob-1"></div>
    <div class="blob blob-2"></div>

    <div class="login-container">
        <a href="index.html" class="logo"><span class="logo-symbol">&int;</span> SJMaths</a>

        <h2>Create Account</h2>
        <p class="subtitle">Join us to master mathematics</p>

        <form id="signupForm">
            <div class="input-group">
                <label>Email Address</label>
                <input type="email" id="email" placeholder="student@example.com" required>
            </div>

            <div class="input-group">
                <label>Password</label>
                <div class="password-wrapper">
                    <input type="password" id="password" placeholder="Create a password" required>
                    <i class="fas fa-eye toggle-password"></i>
                </div>
            </div>

            <div class="input-group">
                <label>Confirm Password</label>
                <div class="password-wrapper">
                    <input type="password" id="confirmPassword" placeholder="Confirm your password" required>
                    <i class="fas fa-eye toggle-password"></i>
                </div>
            </div>

            <button class="login-btn" type="submit">Sign Up</button>

            <button type="button" class="google-btn" id="googleSignupBtn">
                <i class="fab fa-google"></i> Sign up with Google
            </button>

            <div class="links">
                Already have an account? <a href="login.html">Login</a>
            </div>
        </form>

        <a href="index.html" class="back-home">
            <i class="fas fa-arrow-left"></i> Back to Home
        </a>
    </div>

    <!-- FIREBASE AUTH LOGIC -->
    <script type="module">
        import { sendEmailVerification } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-auth.js";
        import { initializeApp, getApps, getApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, GoogleAuthProvider, signInWithPopup } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        import { firebaseConfig } from './assets/js/firebase-config.js';
        import { showToast } from './assets/js/auth.js';

        const emailInput = document.getElementById("email");
        const passwordInput = document.getElementById("password");
        const confirmPasswordInput = document.getElementById("confirmPassword");

        let app;
        if (getApps().length > 0) {
            app = getApp();
        } else {
            app = initializeApp(firebaseConfig);
        }
        const auth = getAuth(app);

        /* TOGGLE PASSWORD VISIBILITY */
        document.querySelectorAll('.toggle-password').forEach(icon => {
            icon.addEventListener('click', (e) => {
                const input = e.target.previousElementSibling;
                const type = input.getAttribute('type') === 'password' ? 'text' : 'password';
                input.setAttribute('type', type);
                e.target.classList.toggle('fa-eye');
                e.target.classList.toggle('fa-eye-slash');
            });
        });

        /* SIGN UP LOGIC */
        document.getElementById("signupForm").addEventListener("submit", async (e) => {
            e.preventDefault();
            const email = emailInput.value;
            const password = passwordInput.value;
            const confirmPassword = confirmPasswordInput.value;
            const btn = document.querySelector(".login-btn");

            if (password !== confirmPassword) {
                showToast("Passwords do not match.", "error");
                return;
            }

            const originalText = btn.innerText;
            btn.innerText = "Creating Account...";
            btn.disabled = true;

            try {
                const userCredential = await createUserWithEmailAndPassword(auth, email, password);
await sendEmailVerification(userCredential.user);

showToast("Verification email sent! Please check your inbox and verify before login.", "success");

setTimeout(() => {
    window.location.href = "login.html";
}, 3000);

                showToast("Account created successfully!", "success");
                const redirectUrl = sessionStorage.getItem('sjmaths_redirect');
                if (redirectUrl) {
                    sessionStorage.removeItem('sjmaths_redirect');
                    window.location.href = redirectUrl;
                } else {
                    window.location.href = "index.html";
                }
            } catch (error) {
                showToast(error.message, "error");
                btn.innerText = originalText;
                btn.disabled = false;
            }
        });

        /* GOOGLE SIGNUP */
        document.getElementById("googleSignupBtn").addEventListener("click", async () => {
            const provider = new GoogleAuthProvider();
            try {
                await signInWithPopup(auth, provider);
                const redirectUrl = sessionStorage.getItem('sjmaths_redirect');
                if (redirectUrl) {
                    sessionStorage.removeItem('sjmaths_redirect');
                    window.location.href = redirectUrl;
                } else {
                    window.location.href = "index.html";
                }
            } catch (error) {
                console.error("Google Sign-Up Error:", error);
                showToast(error.message, "error");
            }
        });

        logEvent(analytics, "sign_up", {
  method: "email"
});

logEvent(analytics, "email_verification_sent");
logEvent(analytics, "email_verified");

    </script>

</body>

</html>